!function(e){var s={};function t(i){if(s[i])return s[i].exports;var a=s[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,t),a.l=!0,a.exports}t.m=e,t.c=s,t.d=function(e,s,i){t.o(e,s)||Object.defineProperty(e,s,{enumerable:!0,get:i})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,s){if(1&s&&(e=t(e)),8&s)return e;if(4&s&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(t.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&s&&"string"!=typeof e)for(var a in e)t.d(i,a,function(s){return e[s]}.bind(null,a));return i},t.n=function(e){var s=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(s,"a",s),s},t.o=function(e,s){return Object.prototype.hasOwnProperty.call(e,s)},t.p="",t(t.s=0)}([function(e,s,t){"use strict";t.r(s),t.d(s,"ValidationRequest",(function(){return p})),t.d(s,"ValidationResponse",(function(){return h})),t.d(s,"Validator",(function(){return v}));class i{constructor(e){this.supernode=null,this.depth=0,this.type=e,this.subtype="",this.start=0,this.end=0,this._text="",this._latex="",this._asciiMath="",this._mathML=""}get length(){return this.end-this.start}get text(){return this._text}get latex(){return this._latex}get asciiMath(){return this._asciiMath}get mathML(){return this._mathML}get subnodes(){return[]}set subnodes(e){}setDepth(e=0){this.depth=e,this.subnodes.forEach(s=>{s.supernode=this,s.setDepth(e+1)})}copyTo(e){e.supernode=this.supernode,e.depth=this.depth,e.type=this.type,e.subtype=this.subtype,e.start=this.start,e.end=this.end,e._text=this._text,e._latex=this._latex,e._asciiMath=this._asciiMath,e._mathML=this._mathML}}class a extends i{constructor(){super("whiteSpace"),this.value=""}}class r extends i{constructor(){super("number"),this.value="",this.integralPart="",this.decimalPart="",this.sign="",this.signIsExplicit=!1,this.isZero=!1,this.integralPartIsZero=!1,this.decimalPartIsZero=!1,this.numberOfLeadingZeros=0,this.numberOfTrailingZeros=0,this.minimumNumberOfSignificantFigures=0,this.maximumNumberOfSignificantFigures=0,this.numberOfDecimalPlaces=0}get latex(){return this.value}get asciiMath(){return this.value}copyTo(e){super.copyTo(e),e.value=this.value,e.integralPart=this.integralPart,e.decimalPart=this.decimalPart,e.sign=this.sign,e.signIsExplicit=this.signIsExplicit,e.isZero=this.isZero,e.integralPartIsZero=this.integralPartIsZero,e.decimalPartIsZero=this.decimalPartIsZero,e.numberOfLeadingZeros=this.numberOfLeadingZeros,e.numberOfTrailingZeros=this.numberOfTrailingZeros,e.minimumNumberOfSignificantFigures=this.minimumNumberOfSignificantFigures,e.maximumNumberOfSignificantFigures=this.maximumNumberOfSignificantFigures,e.numberOfDecimalPlaces=this.numberOfDecimalPlaces}}class n extends r{constructor(){super(),this.currency=""}static fromNumberNode(e){var s=new n;return e.copyTo(s),s}}class o{constructor(){this.position=0}copy(){var e=new o;return e.position=this.position,e}}class g{constructor(){this.removeLeadingZerosFromSimplifiedForms=!1,this.removeTrailingZerosFromSimplifiedForms=!1,this.addLeadingZeroToDecimalsForSimplifiedForms=!0,this.removeTrailingDecimalPointFromSimplifiedForms=!0,this.normaliseSigns="notSet"}}function m(e,s,t=1){return e.substr(s,t)}function c(e,s){return s.indexOf(e)>=0}class l{constructor(){this.settings=new g}getParseResult(e){var s=new o;this.parseWhiteSpace(e,s);var t=this.parseNumber(e,s);return this.parseWhiteSpace(e,s),null!==t&&s.position==e.length?t:null}parseWhiteSpace(e,s){for(var t="",i=s.position;s.position<e.length;){var r=m(e,s.position);if(!c(r," \t\n"))break;t+=r,s.position+=1}if(0==t.length)return null;var n=s.position,o=new a;return o.start=i,o.end=n,o._text=t,o.value=" ",o._latex=t,o._asciiMath=t,o}makeIntoCurrencyValue(e){var s=n.fromNumberNode(e);return s.decimalPartIsZero&&s.decimalPart.length>1&&(s.value=s.value.substring(0,s.value.length-s.numberOfTrailingZeros)),"."==s.value.substr(s.value.length-1,1)&&(s.value=s.value.substr(0,s.value.length-1)),s}parseNumber(e,s){var t="",i=s.position,a="",n="",o="",g="positive",l=!1,u=m(e,s.position);"+"==u?(o="+",l=!0,s.position+=1):"-"==u&&(o="-",g="negative",l=!0,s.position+=1),this.parseWhiteSpace(e,s);for(var d=0,p=0,h=0,v=0,f=0,y=0,x=!0,I=!0;s.position<e.length;){var S=m(e,s.position);if(c(S,"0123456789"))t+=S,s.position+=1,0==y?(a+=S,"0"!=S&&(x=!1)):(n+=S,"0"!=S&&(I=!1),v+=1),"0"==S&&0==h&&0==y?d+=1:"0"!=S?(h+=f,f=0,h+=1):"0"==S&&h>0&&(f+=1);else{if("."!=S)break;if(0!=y)break;t+=S,s.position+=1,n+=S,y+=1}}var T=0===h&&t.length>0,b=0,P=0;T?(b=1,P=1,y>0&&(p=v)):y>0?(b=h+f,P=h+f,p=f):(b=h,P=h+f);var M=s.position,F=0==y?"integer":"decimalNumber",N="",A="";if(A="."===(A=!0===this.settings.removeTrailingZerosFromSimplifiedForms&&p>0?n.substr(0,n.length-p):n)&&!0===this.settings.removeTrailingDecimalPointFromSimplifiedForms?"":A,""!=a||""!=n&&"."!=n?""==a?N=this.settings.addLeadingZeroToDecimalsForSimplifiedForms?"0":"":this.settings.removeLeadingZerosFromSimplifiedForms?(N=a.substr(d),this.settings.addLeadingZeroToDecimalsForSimplifiedForms&&(N=""==N?"0":N)):N=a:N="",o+t=="")return null;var B=new r;B.subtype=F,B.start=i,B.end=M,B._text=o+t;var Z=o;return"positive"===g&&("makeExplicit"===this.settings.normaliseSigns?Z="+":"makeImplicit"===this.settings.normaliseSigns&&(Z="")),B.value=!0===T?N+A:Z+N+A,B.integralPart=a,B.decimalPart=n,B.sign=g,B.signIsExplicit=l,B.isZero=T,B.integralPartIsZero=x,B.decimalPartIsZero=I,B.numberOfLeadingZeros=d,B.numberOfTrailingZeros=p,B.minimumNumberOfSignificantFigures=b,B.maximumNumberOfSignificantFigures=P,B.numberOfDecimalPlaces=v,B}}class u extends Error{constructor(...e){super(...e)}}class d{constructor(e=""){if(this.messagesFile=e,this.messages=[],""!==e){var s=new XMLHttpRequest;s.open("GET",this.messagesFile,!1),s.send();var t=s.responseXML.getElementsByTagName("message");for(let e of t){var i=e.getAttribute("id"),a=e.textContent;this.messages.push({id:i,text:a})}}}getMessageById(e,s=[]){if(0==this.messages.filter(s=>s.id==e).length)throw new u("There is no message with the id '"+e.toString()+"' in "+this.messagesFile+".");var t=this.messages.filter(s=>s.id==e)[0].text,i=0;for(let e of s){var a="#p"+(i+=1).toString()+"#";t=t.replace(a,e.toString())}return t}}class p{constructor(){this.studentsResponse="",this.expectedResponseType="",this.constraints={},this.localisationSettings={}}}class h{constructor(){this.isAccepted=!0,this.messageText="",this.request=null,this.normalisedStudentsResponse="",this.expression=null}}class v{constructor(e=""){this.parser=new l,this.messages=new d(e),this.integerAllowedCharacters="0123456789+- ",this.nonNegativeIntegerAllowedCharacters="0123456789+ ",this.decimalAllowedCharacters="0123456789.+- "}validate(e){null!==e.constraints&&void 0!==e.constraints||(e.constraints={}),!0===e.constraints.removeLeadingZerosFromNormalizedForm&&(this.parser.settings.removeLeadingZerosFromSimplifiedForms=!0),!0===e.constraints.removeTrailingZerosFromNormalizedForm&&"currencyValue"!==e.expectedResponseType&&(this.parser.settings.removeTrailingZerosFromSimplifiedForms=!0),!1===e.constraints.removeTrailingDecimalPointFromNormalizedForm&&(this.parser.settings.removeTrailingDecimalPointFromSimplifiedForms=!1),!1===e.constraints.addSingleLeadingZeroToNormalizedForm&&(this.parser.settings.addLeadingZeroToDecimalsForSimplifiedForms=!1),"makeExplicit"===e.constraints.normalizeSign&&(this.parser.settings.normaliseSigns="makeExplicit"),"makeImplicit"===e.constraints.normalizeSign&&(this.parser.settings.normaliseSigns="makeImplicit");var s=this.parser.getParseResult(e.studentsResponse),t=new h;if(void 0===e.constraints.sign&&(e.constraints.sign="canBeExplicitOrImplicit"),"integer"===e.expectedResponseType)this.validateInteger(e,s,t);else if("nonNegativeInteger"===e.expectedResponseType)this.validateNonNegativeInteger(e,s,t);else if("decimal"===e.expectedResponseType)this.validateDecimal(e,s,t);else{if("currencyValue"!==e.expectedResponseType)throw new ValueError("Unsupported response type '"+e.expectedResponseType+"'.");null!==s&&"number"===s.type&&(s=this.parser.makeIntoCurrencyValue(s)),this.validateCurrencyValue(e,s,t)}return t.request=e,null!==s&&(t.normalisedStudentsResponse=s.asciiMath,t.expression=s),t}validateInteger(e,s,t){t.isAccepted=!0;for(var i=0;i<e.studentsResponse.length;i++){if(!c(e.studentsResponse[i],this.integerAllowedCharacters))return t.isAccepted=!1,void(t.messageText=this.messages.getMessageById("onlyUseIntegerCharacters"))}return null===s||"number"!=s.type?(t.isAccepted=!1,void(t.messageText=this.messages.getMessageById("mustBeSingleInteger"))):"integer"!=s.subtype?(t.isAccepted=!1,void(t.messageText=this.messages.getMessageById("mustBeInteger"))):""===s.integralPart&&""===s.decimalPart?(t.isAccepted=!1,void(t.messageText=this.messages.getMessageById("mustBeSingleInteger"))):(this._applyLeadingZerosConstraints(e,s,t),!1!==t.isAccepted?"mustBeExplicit"==e.constraints.sign&&"positive"==s.sign&&!1===s.signIsExplicit?(t.isAccepted=!1,void(t.messageText=this.messages.getMessageById("mustHaveSign"))):"mustBeImplicit"==e.constraints.sign&&"positive"==s.sign&&!0===s.signIsExplicit?(t.isAccepted=!1,void(t.messageText=this.messages.getMessageById("dontHaveSign"))):void this._applySignificantFigureConstraints(e,s,t):void 0)}validateNonNegativeInteger(e,s,t){t.isAccepted=!0;for(var i=0;i<e.studentsResponse.length;i++){if(!c(e.studentsResponse[i],this.nonNegativeIntegerAllowedCharacters))return t.isAccepted=!1,void(t.messageText=this.messages.getMessageById("onlyUseNonNegativeIntegerCharacters"))}return null===s||"number"!=s.type?(t.isAccepted=!1,void(t.messageText=this.messages.getMessageById("mustBeSingleInteger"))):"integer"!=s.subtype?(t.isAccepted=!1,void(t.messageText=this.messages.getMessageById("mustBeInteger"))):"negative"==s.sign?(t.isAccepted=!1,void(t.messageText=this.messages.getMessageById("mustBePositive"))):""===s.integralPart&&""===s.decimalPart?(t.isAccepted=!1,void(t.messageText=this.messages.getMessageById("mustBeSingleInteger"))):(this._applyLeadingZerosConstraints(e,s,t),!1!==t.isAccepted?"mustBeExplicit"==e.constraints.sign&&!1===s.signIsExplicit?(t.isAccepted=!1,void(t.messageText=this.messages.getMessageById("mustHavePlusSign"))):"mustBeImplicit"==e.constraints.sign&&!0===s.signIsExplicit?(t.isAccepted=!1,void(t.messageText=this.messages.getMessageById("dontHavePlusSign"))):void this._applySignificantFigureConstraints(e,s,t):void 0)}validateDecimal(e,s,t){t.isAccepted=!0;for(var i=0;i<e.studentsResponse.length;i++){if(!c(e.studentsResponse[i],this.decimalAllowedCharacters))return t.isAccepted=!1,void(t.messageText=this.messages.getMessageById("onlyUseDecimalCharacters"))}if(null===s||"number"!=s.type)return t.isAccepted=!1,void(t.messageText=this.messages.getMessageById("mustBeSingleNumber"));if(""===s.integralPart&&""===s.decimalPart)return t.isAccepted=!1,void(t.messageText=this.messages.getMessageById("mustBeSingleNumber"));if(this._applyLeadingZerosConstraints(e,s,t),!1!==t.isAccepted&&(this._applyTrailingZerosConstraints(e,s,t),!1!==t.isAccepted)){if("mustBeExplicit"==e.constraints.sign&&"positive"==s.sign&&!1===s.signIsExplicit)return t.isAccepted=!1,void(t.messageText=this.messages.getMessageById("mustHaveSign"));if("mustBeImplicit"==e.constraints.sign&&"positive"==s.sign&&!0===s.signIsExplicit)return t.isAccepted=!1,void(t.messageText=this.messages.getMessageById("dontHaveSign"));this._applySignificantFigureConstraints(e,s,t),!1!==t.isAccepted&&(this._applyDecimalPlaceConstraints(e,s,t),t.isAccepted)}}validateCurrencyValue(e,s,t){t.isAccepted=!0;for(var i=0;i<e.studentsResponse.length;i++){if(!c(e.studentsResponse[i],this.decimalAllowedCharacters))return t.isAccepted=!1,void(t.messageText=this.messages.getMessageById("onlyUseDecimalCharacters"))}if(null===s||"number"!=s.type)return t.isAccepted=!1,void(t.messageText=this.messages.getMessageById("mustBeSingleNumber"));if(""===s.integralPart&&""===s.decimalPart)return t.isAccepted=!1,void(t.messageText=this.messages.getMessageById("mustBeSingleNumber"));if(this._applyLeadingZerosConstraints(e,s,t),!1!==t.isAccepted){if("mustBeExplicit"==e.constraints.sign&&"positive"==s.sign&&!1===s.signIsExplicit)return t.isAccepted=!1,void(t.messageText=this.messages.getMessageById("mustHaveSign"));if("mustBeImplicit"==e.constraints.sign&&"positive"==s.sign&&!0===s.signIsExplicit)return t.isAccepted=!1,void(t.messageText=this.messages.getMessageById("dontHaveSign"));if(0!=["USD","GBP","EGP","SAR"].filter(s=>s==e.constraints.currency).length)return 0!=s.numberOfDecimalPlaces&&2!=s.numberOfDecimalPlaces?(t.isAccepted=!1,void(t.messageText=this.messages.getMessageById("mustHaveExactlyNDP",[2]))):void 0}}_applyLeadingZerosConstraints(e,s,t){void 0===e.constraints.allowLeadingZeros&&(e.constraints.allowLeadingZeros=!1);var i=s.integralPartIsZero?1:0;if(!1===e.constraints.allowLeadingZeros&&s.numberOfLeadingZeros>i)return t.isAccepted=!1,void(t.messageText=this.messages.getMessageById("noLeadingZeros"))}_applyTrailingZerosConstraints(e,s,t){if(void 0===e.constraints.allowTrailingZeros&&(e.constraints.allowTrailingZeros=!0),!1===e.constraints.allowTrailingZeros&&s.numberOfTrailingZeros>0)return t.isAccepted=!1,void(t.messageText=this.messages.getMessageById("noTrailingZeros"))}_applySignificantFigureConstraints(e,s,t){if(void 0===e.constraints.mustHaveExactlyNSF){if(void 0!==e.constraints.mustHaveAtLeastNSF){i=e.constraints.mustHaveAtLeastNSF;if(s.maximumNumberOfSignificantFigures<i)return t.isAccepted=!1,void(t.messageText=1==i?this.messages.getMessageById("mustHaveAtLeast1SF"):this.messages.getMessageById("mustHaveAtLeastNSF",[i]))}if(void 0!==e.constraints.mustHaveNoMoreThanNSF){i=e.constraints.mustHaveNoMoreThanNSF;if(s.minimumNumberOfSignificantFigures>i)return t.isAccepted=!1,void(t.messageText=1==i?this.messages.getMessageById("mustHaveNoMoreThan1SF"):this.messages.getMessageById("mustHaveNoMoreThanNSF",[i]))}}else{var i=e.constraints.mustHaveExactlyNSF;(s.maximumNumberOfSignificantFigures<i||s.minimumNumberOfSignificantFigures>i)&&(t.isAccepted=!1,t.messageText=1==i?this.messages.getMessageById("mustHaveExactly1SF"):this.messages.getMessageById("mustHaveExactlyNSF",[i]))}}_applyDecimalPlaceConstraints(e,s,t){if(void 0===e.constraints.mustHaveExactlyNDP){if(void 0!==e.constraints.mustHaveAtLeastNDP){i=e.constraints.mustHaveAtLeastNDP;if(s.numberOfDecimalPlaces<i)return t.isAccepted=!1,void(t.messageText=1==i?this.messages.getMessageById("mustHaveAtLeast1DP"):this.messages.getMessageById("mustHaveAtLeastNDP",[i]))}if(void 0!==e.constraints.mustHaveNoMoreThanNDP){i=e.constraints.mustHaveNoMoreThanNDP;if(s.numberOfDecimalPlaces>i)return t.isAccepted=!1,void(t.messageText=1==i?this.messages.getMessageById("mustHaveNoMoreThan1DP"):this.messages.getMessageById("mustHaveNoMoreThanNDP",[i]))}}else{var i=e.constraints.mustHaveExactlyNDP;s.numberOfDecimalPlaces!=i&&(t.isAccepted=!1,t.messageText=1==i?this.messages.getMessageById("mustHaveExactly1DP"):this.messages.getMessageById("mustHaveExactlyNDP",[i]))}}}}]);